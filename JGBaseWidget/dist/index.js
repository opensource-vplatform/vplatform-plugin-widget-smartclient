!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";isc.ClassFactory.defineInterface("IV3BaseWidget"),isc.IV3BaseWidget.addInterfaceProperties({Top:0,Left:0,Width:null,MultiWidth:null,Height:null,MutiHeight:null,ContentAlignment:null,HorizontalAlign:null,VerticalAlign:null,_orginalRect:null}),isc.IV3BaseWidget.addInterfaceMethods({initV3Widget:function(){this.id=isc.WidgetUtils.genWidgetRefId(this.scopeId,this.widgetId);var e=[this.Width,this.Height];this._orginalRect=e,isc.JGWidgetManager.putWidget(this.id,this)},_processRect:function(e,t){if("string"==typeof e){if("content"==e)return 20;if(e.endsWith("%"))return e;if(e.endsWith("px"))return parseInt(e)}return e},_processContentVal:function(e){return parseInt(.5*e)},getProcessedHeight:function(){return this._processRect(this.MultiHeight,"height")},getProcessedWidth:function(){return this._processRect(this.MultiWidth,"width")},setPercentHeight:function(e){this.setHeight(e)},setPercentWidth:function(e){this.setWidth(e)},getOrginalRect:function(){return this._orginalRect},addV3Child:function(e){this.addChild(e)},buildRelation:function(){var e=this.layoutChildWidgets();if(e&&e.length>0)for(var t=0;s=e[t];t++)this.addV3Child(s);var i=isc.WidgetContext.getChildrenIds(this.scopeId,this.widgetId);if(i&&i.length>0){var n;for(t=0;n=i[t];t++){var s,r=isc.WidgetUtils.genWidgetRefId(this.scopeId,n);(s=isc.JGWidgetManager.getWidget(r))&&s.buildRelation()}}},getContentAlignment:function(){return this.ContentAlignment},getHorizontalAlign:function(){return this.HorizontalAlign},getVerticalAlign:function(){return this.VerticalAlign},parentReadOnly:function(e){"JGGroupPanel"==this.type&&(e&&this.childrenWidgets&&1==this.childrenWidgets.length?(this.realHeight=this.getVisibleHeight(),this.setHeight(0)):"number"==typeof this.realHeight&&this.setHeight(this.realHeight)),this.ReadOnly||(this._ReadOnly=e,this.setHandleReadOnly&&this.setHandleReadOnly(e),this.childrenWidgets&&this.childrenWidgets.map("parentReadOnly",e))},on:function(e,t){if("ConfigChanged"==e&&t(),this.listener||(this.listener=[]),this.listener.hasOwnProperty(e))this.listener[e].push(t);else if("ConfigChanged"!=e)throw Error("控件["+this.getClassName()+"]不支持["+e+"]事件！")},un:function(e){if(this.listener){if(!this.listener.hasOwnProperty(e))throw Error("控件["+this.getClassName()+"]不支持["+e+"]事件！");this.listener[e]=[]}},getLayoutVersion:function(){return this._$windowVersion},isOldWindowLayoutConfig:function(){var e=this.getLayoutVersion();if(null==e||""==e)return!0;var t="number"==typeof this.Width&&-1!=this.MultiWidth.indexOf("px")&&this.MultiWidth!=this.Width+"px",i="number"==typeof this.Height&&-1!=this.MultiHeight.indexOf("px")&&this.MultiHeight!=this.Height+"px";return!(!t||!i)},firePlatformEventBefore:function(e,t,i){},firePlatformEventAfter:function(e,t,i){}}),isc.ClassFactory.defineInterface("IV3RectAdapter"),isc.IV3RectAdapter.addInterfaceMethods({adaptRectByV3:function(){"content"==this.MultiHeight&&this.adaptHeightByV3(),"content"==this.MultiWidth&&this.adaptWidthByV3()},adaptHeightByV3:function(){this.canAdaptHeight=!0,this.adaptHeightBy=function(){return 0}},adaptWidthByV3:function(){this.canAdaptWidth=!0,this.adaptWidthBy=function(){return 0}}}),isc.ClassFactory.defineInterface("IWindowAop"),isc.IWindowAop.addInterfaceMethods({dataLoaded:function(){},windowInited:function(){},windowLoaded:function(){},beforeDataLoad:function(){},afterDataLoad:function(){}}),isc.ClassFactory.defineClass("JGBaseWidget","Canvas"),isc.ClassFactory.mixInInterface("JGBaseWidget","JGEventManager"),isc.ClassFactory.mixInInterface("JGBaseWidget","JGLayoutManager"),isc.ClassFactory.mixInInterface("JGBaseWidget","IV3BaseWidget"),isc.JGBaseWidget.addClassProperties({_initedHandlers:[]}),isc.JGBaseWidget.addClassMethods({addInitedHandler:function(e){isc.JGBaseWidget._initedHandlers.push(e)}}),isc.JGBaseWidget.addProperties({defaultWidth:5,defaultHeight:5,autoDraw:!1,id:"",widgetId:"",scopeId:null,componentId:null,name:"",_fieldEvent:null,contents:"",TableName:null,SourceTableName:null,MultiHeight:null,MultiWidth:null,Dock:null,LayoutType:null,PercentWidth:null,PercentHeight:null,StaticLayoutSize:!1,hoverWidth:250,canFocus:!0,showFocusOutline:!1,_orginalRect:null,_defaultListener:["mouseOver","mouseLeave","showProtoInfo","moveProtoInfo"],listener:[],VerticalAlign:"Top",HorizontalAlign:"Left",ContentAlignment:"Horizontal"}),isc.JGBaseWidget.addMethods({init:function(){this.id=isc.WidgetUtils.genWidgetRefId(this.scopeId,this.widgetId);var e=[this.Width,this.Height];this._orginalRect=e,this._fieldEvent={},this._initCanvas(arguments),this.Super("init",arguments),this._initWidget(arguments),this._initListener(),this._enhanceEvents(),this._afterInitWidget(),this._referPartFunc(),this.mouseOver=this._handleMouseOver,this.mouseLeave=this._referEvent(this,"mouseLeave"),isc.JGWidgetManager.putWidget(this.id,this);for(var t=isc.JGBaseWidget._initedHandlers,i=0,n=t.length;i<n;i++){var s=t[i];s.apply(this)}},_enhanceEvents:function(){var e=this.listener;if(e)for(var t in e)if(e.hasOwnProperty(t)){var i=this[t];"function"==typeof i&&this.listener[t].push(i)}},_handleMouseOver:function(){this.fireEvent("mouseOver");["JGTreeGrid","JGDataGrid","JGTabControl","JGQueryConditionPanel"].filter((function(e){return e===this.WidgetStyle})).length||this.fireEvent("showProtoInfo",null,this.getClipHandle(),[this.Code])},resizeTo:function(){this.Super("resizeTo",arguments),this.fireEvent("moveProtoInfo")},addV3Child:function(e){this.addChild(e)},getOrginalRect:function(){return this._orginalRect},_initCanvas:function(){if(this.left=this.Left,this.top=this.Top,this.isOldWindowLayoutConfig&&this.isOldWindowLayoutConfig())this.LayoutType&&"BorderLayout"!=this.LayoutType||this.Dock&&"Fill"!=this.Dock?(this.width=this.Width,this.height=this.Height):(this.width="100%",this.height="100%");else{var e=(this.Dock+"").toLowerCase();"space"==this.MultiWidth||"top"==e||"bottom"==e||"fill"==e?(this.width="100%",this.Width="100%"):"content"==this.MultiWidth?(this.width=null,this.Width=null):"string"==typeof this.MultiWidth?"0px"==this.MultiHeight?this.height=this.Height:(this.width=this.MultiWidth,this.MultiWidth.endsWith("px")?this.Width=parseInt(this.MultiWidth):this.Width="100%"):this.width="BorderLayout"==this.LayoutType?"100%":this.Width,"space"==this.MultiHeight||"left"==e||"right"==e||"fill"==e?(this.height="100%",this.Height="100%"):"content"==this.MultiHeight?("JGComponentContainer"==this.type&&(this._height=this.Height),this.height=null,this.Height=null):"string"==typeof this.MultiHeight?"0px"==this.MultiHeight?this.height=this.Height:(this.height=this.MultiHeight,this.MultiHeight.endsWith("px")?this.Height=parseInt(this.MultiHeight):this.Height="100%"):this.height="BorderLayout"==this.LayoutType?"100%":this.Height}this.printChildrenAbsolutelyPositioned=!0,isc.isA.Boolean(this.Visible)&&(this.visibility=this.Visible?isc.Canvas.INHERIT:isc.Canvas.HIDDEN)},_initListener:function(){var e={};this.listener=this.listener.concat(this._defaultListener);for(var t=0,i=this.listener.length;t<i;t++)e[this.listener[t]]=[];this.listener=e},_initWidget:function(){},_afterInitWidget:function(){},_referPartFunc:function(){},_addMethods:function(e,t){for(var i in t)e[i]=t[i]},_referFuncs:function(e,t){isc.isAn.Array(t)||(t=[t]);for(var i=0,n=t.length;i<n;i++){var s=t[i];this[s]=this._referFunc(e,s)}},_referFunc:function(e,t){var i=e.ID;return function(){var e=this.getWindow()[i];if(!e)throw Error("不存在["+i+"]对象，请检查！");var n=e[t];if("function"==typeof n){for(var s=[],r=0,a=arguments.length;r<a;r++)s.push(arguments[r]);return n.apply(e,s)}throw Error(e.getClass()+"不存在方法"+t)}},_referEvent:function(e,t){isc.isAn.Array(t)||(t=[t]);var i;e.ID;return i=e,function(){var e=i.ID,n=this.getWindow()[e];if(!n)throw Error("不存在["+e+"]对象，请检查！");if(t&&t.length>0)for(var s=0,r=t.length;s<r;s++){var a=t[s];if("function"==typeof a)a.apply(n,arguments);else if(n.listener){var d=n.listener[a];if(d&&d.length>0)for(var l=0,o=d.length;l<o;l++){var h=d[l];h.apply(n,arguments)}}}return!0}},_referEventTimeout:function(e,t){isc.isAn.Array(t)||(t=[t]);var i=e.ID;return function(){return t&&t.length>0&&setTimeout((function(){var e=window[i];if(!e)throw Error("不存在["+i+"]对象，请检查！");for(var n=0,s=t.length;n<s;n++){var r=t[n];if("function"==typeof r)r.apply(e,arguments);else if(e.listener){var a=e.listener[r];if(a&&a.length>0)for(var d=0,l=a.length;d<l;d++){var o=a[d];o.apply(e,arguments)}}}}),10),!0}},_referTimerEventHandler:function(e,t){isc.isAn.Array(t)||(t=[t]);var i=e.ID;return function(){var e=this.getWindow()[i];if(!e)throw Error("不存在["+i+"]对象，请检查！");if(t&&t.length>0)for(var n=0,s=t.length;n<s;n++){var r=t[n];if("function"==typeof r)r.apply(e,arguments);else{var a=e.listener[r];if(a&&a.length>0)for(var d=0,l=a.length;d<l;d++){var o=a[d];isc.TimerEventHandler.push((function(){var e=window[i];e&&e.pause&&e.pause()})),isc.TimerEventHandler.push((function(){var e=window[i];e&&(o.apply(e,arguments),e.resume&&!e.destroyed&&e.resume())})),isc.TimerEventHandler.run()}}}return!0}},_callEvent:function(e,t){if(isc.isAn.Array(t)||(t=[t]),t&&t.length>0){for(var i=[],n=2,s=arguments.length;n<s;n++)i.push(arguments[n]);for(n=0,s=t.length;n<s;n++){var r=t[n],a=e.listener[r];if(a&&a.length>0)for(var d=0,l=a.length;d<l;d++){var o=a[d];arguments.callee.caller!==o&&o.apply(e,i)}}}return!0},fireEvent:function(e){if(this.listener){var t=this.listener[e];if(t&&t.length>0){for(var i=[],n=2,s=arguments.length;n<s;n++)i.push(arguments[n]);for(var r=0,a=t.length;r<a;r++){var d=t[r];d.apply(this,i)}}}},getId:function(){return this.widgetId},destroy:function(){this.mouseOver=null,this.mouseLeave=null,this.showProtoInfo=null,this.moveProtoInfo=null,this.listener=null,this._Layout=null,isc.JGWidgetManager.destroy(this.id);var e=this.childrenWidgets;e&&(this.childrenWidgets=null),this.Super("destroy",arguments)},getProperty:function(e){var t=this["get"+e];if("function"==typeof t||"function"==typeof(t=this["is"+e])){for(var i=[],n=1,s=arguments.length;n<s;n++)i.push(arguments[n]);return t.apply(this,i)}},setProperty:function(e,t){var i=this["set"+e];if("function"==typeof i){for(var n=[],s=1,r=arguments.length;s<r;s++)n.push(arguments[s]);return i.apply(this,n)}throw Error(this.getClassName()+"不存在["+e+"]属性!")},setTips:function(e){if(this._form)if(this._form.getItems().length>0){if(this._form.getItems()[0].setPrompt(e),this._form.getItems()[0].isA("MultiFieldFormItem")){var t=this._form.children[0].getItem();if(t.setPrompt(e),t.hasOwnProperty("getItems"))for(var i=0;i<t.length;i++)t[i].setPrompt(e)}}else this._form.setPrompt(e);else this.setPrompt(e),this.children&&this.children.length>0&&this.children[0].setPrompt(e)},setVisible:function(e){this.Visible=e,e?this.show():this.hide()},getVisible:function(){return this.Visible},setTableName:function(e){this.TableName=e},getTableName:function(){return this.TableName},getSourceTableName:function(){return this.SourceTableName},getDock:function(){return this.Dock},setDock:function(e){this.Dock=e},getLayoutType:function(){return this.LayoutType},setLayoutType:function(e){this.LayoutType=e},getPercentWidth:function(){return this.PercentWidth},setPercentWidth:function(e){this.setWidth(e)},getPercentHeight:function(){return this.PercentHeight},setPercentHeight:function(e){this.setHeight(e)},getStaticLayoutSize:function(){return this.StaticLayoutSize},setStaticLayoutSize:function(e){this.StaticLayoutSize=e},addWidgets:function(e,t){e.childrenWidgets||(e.childrenWidgets=[]),e.childrenWidgets.add(t),t.parentWidget=e},parentReadOnly:function(e,t){t||(this._ReadOnly=e,this.canEditReadOnly=!1),this.setHandleReadOnly&&(t&&(this._ReadOnly=e),this.setHandleReadOnly(e,t)),this.childrenWidgets&&this.mapping(this.childrenWidgets,"parentReadOnly",e,t)},isReadOnly:function(){return this._ReadOnly||this.ReadOnly},_performOldReadonlyAction:function(e,t){if(1==e){if(this.isReadOnly())return void(this.ReadOnly=e);this.setHandleReadOnly&&this.setHandleReadOnly(e),this._ReadOnly=e,this.childrenWidgets&&this.mapping(this.childrenWidgets,"parentReadOnly",e,t),this.ReadOnly=e}else{if(!this.isReadOnly())return;if(this.parentWidget&&this.parentWidget.isReadOnly())return void(this.ReadOnly=e);this.setHandleReadOnly&&this.setHandleReadOnly(e),this._ReadOnly=e,this.childrenWidgets&&this.mapping(this.childrenWidgets,"parentReadOnly",e,t),this.ReadOnly=e}},_performNewReadonlyAction:function(e,t){if(t)this.setHandleReadOnly?this.setHandleReadOnly(e,t):this.childrenWidgets&&this.mapping(this.childrenWidgets,"parentReadOnly",e,t);else if(this.canEditReadOnly=!1,1==e){if(this.isReadOnly()&&!t)return void(this.ReadOnly=e);this.setHandleReadOnly&&!1!==this.canEditReadOnly&&this.setHandleReadOnly(e),this._ReadOnly=e,this.childrenWidgets&&this.mapping(this.childrenWidgets,"parentReadOnly",e,t),this.ReadOnly=e}else{if(!this.isReadOnly())return;if(this.parentWidget&&this.parentWidget.isReadOnly()&&!t)return void(this.ReadOnly=e);this.setHandleReadOnly&&!1!==this.canEditReadOnly&&this.setHandleReadOnly(e),this._ReadOnly=e,this.childrenWidgets&&this.mapping(this.childrenWidgets,"parentReadOnly",e,t),this.ReadOnly=e}},setReadOnly:function(e,t){isc.isA.Boolean(e)&&this.ReadOnly!=e&&(this.isOldWindowLayoutConfig()?this._performOldReadonlyAction(e,t):this._performNewReadonlyAction(e,t))},parentDisabled:function(e){this.disabled||(this._disabled=e,this.setHandleDisabled&&this.setHandleDisabled(e),this.childrenWidgets&&this.mapping(this.childrenWidgets,"parentDisabled",e))},isDisabled:function(){for(var e=this;e;){if(e._disabled||e.disabled)return!0;(e=e.parentElement)&&e.eventProxy&&(e=e.eventProxy)}return!1},setDisabled:function(e){if(isc.isA.Boolean(e)&&this.disabled!=e)if(1==e){if(this.isDisabled())return void(this.disabled=e);this.setHandleDisabled&&this.setHandleDisabled(e),this._disabled=e,this.disabled=e,this.childrenWidgets&&this.mapping(this.childrenWidgets,"parentDisabled",e)}else{if(!this.isDisabled())return;if(this.parentWidget&&this.parentWidget.isDisabled())return void(this.disabled=e);this.setHandleDisabled&&this.setHandleDisabled(e),this._disabled=e,this.disabled=e,this.childrenWidgets&&this.mapping(this.childrenWidgets,"parentDisabled",e)}},getPrintTagStartAttributes:function(e){return e?" style='position:absolute;left:"+this.getLeft()+"px;top:"+this.getTop()+"px;width:"+this.getWidth()+"px;height:"+this.getHeight()+"px;' ":this.printChildrenAbsolutelyPositioned?" style='position:relative;width:"+this.getScrollWidth()+"px;height:"+this.getScrollHeight()+"px;' ":null},controlPrintPreview:function(e){isc.Page&&(isc.Page.getScrollTop()>0||isc.Page.getScrollLeft()>0)&&isc.Page.scrollTo(0,0),isc.Canvas.showPrintPreview(e)},controlPrint:function(e){isc.Canvas.printComponents(e)},setControlFocus:function(){this.focus()},getFieldEvent:function(){return this._fieldEvent},setScopeId:function(e){this.scopeId=e},getScopeId:function(){return this.scopeId},setComponentId:function(e){this.componentId=e},getComponentId:function(){if(this.componentId)return this.componentId;if(this.scopeId){var e=this.scopeId.lastIndexOf("_"),t=this.scopeId.substring(e+1,this.scopeId.length);return this.componentId=t,t}return null},show:function(){!0===this._needToBuildRelation&&this.buildRelation(),this.Super("show",arguments)},buildRelation:function(){if(this.getVisible()){var e=this.layoutChildWidgets();if(e&&e.length>0)for(var t=0;a=e[t];t++)this.addV3Child(a);var i=this.getComponentId(),n=isc.JGComponent.getComponentIndex(i),s=isc.WidgetContext.getChildrenIds(this.scopeId,this.widgetId);if(s&&s.length>0){var r;for(t=0;r=s[t];t++){var a,d=isc.WidgetUtils.genWidgetRefId(this.scopeId,r);(a=isc.JGWidgetManager.getWidget(d))&&((this.ReadOnly||this.isReadOnly())&&a.parentReadOnly(!0),(0==this.Enabled||this.isDisabled())&&a.parentDisabled(!0),a.setIndexPreJoinComponentIndex&&a.setIndexPreJoinComponentIndex(n),this.addWidgets(this,a),a.buildRelation())}}}else this._needToBuildRelation=!0},getContentAlignment:function(){return this.ContentAlignment},getHorizontalAlign:function(){return this.HorizontalAlign},getVerticalAlign:function(){return this.VerticalAlign},revert:function(e){if(this.listener)for(var t in this.listener)this.listener[t]=[];if(!1!==e){var i=isc.WidgetContext.getChildrenIds(this.scopeId,this.widgetId);if(i&&i.length>0)for(var n,s=0;n=i[s];s++){var r=isc.WidgetUtils.genWidgetRefId(this.scopeId,n),a=isc.JGWidgetManager.getWidget(r);a&&(a.revert&&a.revert())}}},un:function(e,t){if(e&&t&&t.length>0)for(var i=0,n=t.length;i<n;i++){e[t[i]]=null}},getStaticImagePath:function(e){return e?window&&window._$basePath?window._$basePath+e:e:null},getActiveChildWidgets:function(){return this.getVisible&&this.getVisible()&&this.code?[this.code]:null},getActiveChildWindows:function(){return null},isInLayoutWidget:function(){return"JGGroupPanel"==this.getParentType(this)},getParentType:function(e){var t=e.parentElement;if(t){var i=t.type;i||(i=e.getParentType(e.parentElement))}return i},showHighlight:function(){var e=this.styleName;(e||-1==e.indexOf(" v3ComponentHighlight"))&&(e=e?e+" v3ComponentHighlight":"v3ComponentHighlight",this.setStyleName(e))},hideHighlight:function(){var e=this.styleName;e&&-1!=e.indexOf(" v3ComponentHighlight")&&(e=e.replace(" v3ComponentHighlight",""),this.setStyleName(e))},mapping:function(e,t,i,n){0!=e.length&&e.forEach((function(e){e[t]&&e[t](i,n)}))},validateWidget:function(){if(!1===this.Visible)return!0;var e=!0,t=this.scopeId,i=isc.WidgetContext.getChildrenIds(this.scopeId,this.widgetId);return this.validate&&"function"==typeof this.validate?e=this.validate():i&&$.each(i,(function(i,n){var s=isc.WidgetUtils.genWidgetRefId(t,n),r=isc.JGWidgetManager.getWidget(s);r.validateWidget&&!r.validateWidget()&&(e=!1)})),e}}),isc.ClassFactory.defineInterface("IRecordObserver"),isc.IRecordObserver.addInterfaceMethods({fire:function(e){var t=e.eventName,i=e.datasource;switch(t){case i.Events.LOAD:return this._loadAction.apply(this,[e]);case i.Events.UPDATE:return this._updateAction.apply(this,[e]);case i.Events.DELETE:return this._deleteAction.apply(this,[e]);case i.Events.CURRENT:return this._currentAction.apply(this,[e])}},_loadAction:function(e){e.isAppend||this.clearWidgetData(),this._$fireEventHandler(this.__loadHandler)},_updateAction:function(e){for(var t=e.resultSet,i=e.datasource,n=0,s=t.length;n<s;n++){var r=t[n];if(i.isCurrentRecord(r)){this._handleValue(r),this._isChanged(r)&&this.filterChanged(r)&&this._$fireEventHandler(this.__updateHandler);break}}},filterChanged:function(e){return!0},_isChanged:function(e){var t=this.getBindFields();if(t&&t.length>0)for(var i=0,n=t.length;i<n;i++){var s=t[i];if(e.hasOwnProperty(s))return!0}return!1},_handleValue:function(e){var t=this.getBindFields();if(t&&t.length>0)if(t.length>1){for(var i={},n=0,s=t.length;n<s;n++){var r=t[n];e.hasOwnProperty(r)&&(i[r]=e[r])}this.setWidgetData(i,e)}else{r=t[0];e.hasOwnProperty(r)&&this.setWidgetData(e[r],e)}},_$fireEventHandler:function(e){if(e)for(var t=0,i=e.length;t<i;t++){e[t].apply(this,[])}},_deleteAction:function(){this.clearWidgetData()},_currentAction:function(e){var t=e.currentRecord;this._handleValue(t)},onLoadListener:function(e){"function"==typeof e&&(this.__loadHandler=this.__loadHandler||[],this.__loadHandler.push(e))},onChangedListener:function(e){"function"==typeof e&&(this.__updateHandler=this.__updateHandler||[],this.__updateHandler.push(e))},getBindFields:function(){return[]},setWidgetData:function(e,t){},clearWidgetData:function(){}}),isc.ClassFactory.defineClass("CurrentRecordObserver"),isc.CurrentRecordObserver.addProperties({fields:null,setValueHandler:null,clearValueHandler:null}),isc.CurrentRecordObserver.addMethods({fire:function(e){var t=e.eventName,i=e.datasource;switch(t){case i.Events.LOAD:return this._loadAction.apply(this,[e]);case i.Events.UPDATE:return this._updateAction.apply(this,[e]);case i.Events.DELETE:return this._deleteAction.apply(this,[e]);case i.Events.CURRENT:return this._currentAction.apply(this,[e])}},_loadAction:function(e){e.isAppend||this._fireHandler(this.clearValueHandler,[])},_updateAction:function(e){for(var t=e.resultSet,i=e.datasource,n=0,s=t.length;n<s;n++){var r=t[n];if(i.isCurrentRecord(r)){this._handleValue(r,i);break}}},_isChanged:function(e){var t=this.getBindFields();if(t&&t.length>0)for(var i=0,n=t.length;i<n;i++){var s=t[i];if(e.hasOwnProperty(s))return!0}return!1},_handleValue:function(e,t){this._isChanged(e)&&this._fireHandler(this.setValueHandler,[e,t])},_fireHandler:function(e,t){e&&e.apply(this,t)},_deleteAction:function(){this._fireHandler(this.clearValueHandler,[])},_currentAction:function(e){var t=e.currentRecord,i=e.datasource;this._handleValue(t,i)},getBindFields:function(){return this.fields||[]},setWidgetValueHandler:function(e){this.setValueHandler=e},clearWidgetValueHandler:function(e){this.clearValueHandler=e}}),isc.ClassFactory.defineClass("DatasourceObserver"),isc.DatasourceObserver.addProperties({loadHandler:null,insertHandler:null,updateHandler:null,deleteHandler:null,currentHandler:null,selectHandler:null,fetchHandler:null,fetchedHandler:null}),isc.DatasourceObserver.addMethods({fire:function(e){var t=e.eventName,i=e.datasource;switch(t){case i.Events.LOAD:return this._fireHandler(this.loadHandler,e);case i.Events.INSERT:return this._fireHandler(this.insertHandler,e);case i.Events.UPDATE:return this._fireHandler(this.updateHandler,e);case i.Events.DELETE:return this._fireHandler(this.deleteHandler,e);case i.Events.CURRENT:return this._fireHandler(this.currentHandler,e);case i.Events.SELECT:return this._fireHandler(this.selectHandler,e);case i.Events.FETCH:return this._fireHandler(this.fetchHandler,e);case i.Events.FETCHED:return this._fireHandler(this.fetchedHandler,e)}},setLoadHandler:function(e){this.loadHandler=e},setInsertHandler:function(e){this.insertHandler=e},setUpdateHandler:function(e){this.updateHandler=e},setDeleteHandler:function(e){this.deleteHandler=e},setCurrentHandler:function(e){this.currentHandler=e},setSelectHandler:function(e){this.selectHandler=e},setFetchHandler:function(e){this.fetchHandler=e},setFetchedHandler:function(e){this.fetchedHandler=e},_fireHandler:function(e,t){"function"==typeof e&&e.call(this,t)}}),isc.ClassFactory.defineInterface("IDatasourceObserver"),isc.IDatasourceObserver.addInterfaceMethods({fire:function(e){var t=e.eventName,i=e.datasource;switch(t){case i.Events.LOAD:return this._fireHandler(this._v3LoadHandler,e);case i.Events.INSERT:return this._fireHandler(this._v3InsertHandler,e);case i.Events.UPDATE:return this._fireHandler(this._v3UpdateHandler,e);case i.Events.DELETE:return this._fireHandler(this._v3DeleteHandler,e);case i.Events.CURRENT:return this._fireHandler(this._v3CurrentHandler,e);case i.Events.SELECT:return this._fireHandler(this._v3SelectHandler,e);case i.Events.FETCH:return this._fireHandler(this._v3FetchHandler,e);case i.Events.FETCHED:return this._fireHandler(this._v3FetchedHandler,e)}},setLoadHandler:function(e){this._v3LoadHandler=e},setInsertHandler:function(e){this._v3InsertHandler=e},setUpdateHandler:function(e){this._v3UpdateHandler=e},setDeleteHandler:function(e){this._v3DeleteHandler=e},setCurrentHandler:function(e){this._v3CurrentHandler=e},setSelectHandler:function(e){this._v3SelectHandler=e},setFetchHandler:function(e){this._v3FetchHandler=e},setFetchedHandler:function(e){this._v3FetchedHandler=e},_fireHandler:function(e,t){"function"==typeof e&&e.call(this,t)}}),isc.ClassFactory.defineClass("WidgetDatasource"),isc.WidgetDatasource.addClassMethods({getDatasource:function(e,t){if(null!=t&&null!=t||(t=isc.V3Datasource.isA(e)?e:e.TableName),null!=t&&null!=t)return t},getBindDatasource:function(e){return isc.WidgetDatasource.getDatasource(e)},getFields:function(e,t){if(null==t||null==t){if(!e.getBindFields)throw Error("控件未提供getBindFields接口，无法绑定更新回调！控件类型："+e.getClassName());t=e.getBindFields()}return Array.isArray(t)||(t=[t]),t},addBindDatasourceCurrentRecordUpdateEventHandler:function(e,t,i,n){if((t=isc.WidgetDatasource.getDatasource(e,t))&&t.addObserver){i=isc.WidgetDatasource.getFields(e,i);var s=isc.CurrentRecordObserver.create({fields:i,setValueHandler:n});t.addObserver(s)}},addBindDatasourceCurrentRecordClearEventHandler:function(e,t,i,n){if((t=isc.WidgetDatasource.getDatasource(e,t))&&t.addObserver){i=isc.WidgetDatasource.getFields(e,i);var s=isc.CurrentRecordObserver.create({fields:i,clearValueHandler:n});t.addObserver(s)}},_addDatasourceEventHandler:function(e,t,i,n){if((t=isc.WidgetDatasource.getDatasource(e,t))&&t.addObserver){var s={};s[i]=n;var r=isc.DatasourceObserver.create(s);t.addObserver(r)}},addBindDatasourceCurrentEventHandler:function(e,t,i){isc.WidgetDatasource._addDatasourceEventHandler(e,t,"currentHandler",i)},addBindDatasourceSelectEventHandler:function(e,t,i){isc.WidgetDatasource._addDatasourceEventHandler(e,t,"selectHandler",i)},addBindDatasourceLoadEventHandler:function(e,t,i){isc.WidgetDatasource._addDatasourceEventHandler(e,t,"loadHandler",i)},addBindDatasourceFetchEventHandler:function(e,t,i){isc.WidgetDatasource._addDatasourceEventHandler(e,t,"fetchHandler",i)},addBindDatasourceFetchedEventHandler:function(e,t,i){isc.WidgetDatasource._addDatasourceEventHandler(e,t,"fetchedHandler",i)},addBindDatasourceInsertEventHandler:function(e,t,i){isc.WidgetDatasource._addDatasourceEventHandler(e,t,"insertHandler",i)},addBindDatasourceUpdateEventHandler:function(e,t,i){isc.WidgetDatasource._addDatasourceEventHandler(e,t,"updateHandler",i)},addBindDatasourceDeleteEventHandler:function(e,t,i){isc.WidgetDatasource._addDatasourceEventHandler(e,t,"deleteHandler",i)},clearValue:function(e,t){var i=e.TableName;if(i&&i.updateRecords){var n=isc.WidgetDatasource.getFields(e),s=t?i.getSelectedRecords():i.getAllRecords(),r=[];if(n&&n.length>0&&s&&s.length>0)for(var a=0,d=s.length;a<d;a++){for(var l={id:s[a].id},o=0,h=n.length;o<h;o++)l[n[o]]=null;r.push(l)}r.length>0&&i.updateRecords(r)}},setSingleValue:function(e,t){var i=isc.WidgetDatasource.getDatasource(e),n=isc.WidgetDatasource.getFields(e);if(n.length>1)throw new Error("接口调用错误，控件【"+e.getClassName()+"】绑定了多个字段！");var s=n[0],r=i.getCurrentRecord();r||(r=i.createRecord(),i.insertRecords([r]),r=i.getRecordById(r.id)),(r={id:r.id})[s]=t,i.updateRecords([r])},setSingleRecordMultiValue:function(e,t){var i=isc.WidgetDatasource.getDatasource(e),n=i.getCurrentRecord();n||(n=i.createRecord(),i.insertRecords([n]),n=i.getRecordById(n.id));var s={id:n.id};for(var r in t)t.hasOwnProperty(r)&&(s[r]=t[r]);i.updateRecords([s])},getSingleValue:function(e){var t=isc.WidgetDatasource.getDatasource(e),i=isc.WidgetDatasource.getFields(e),n=null;if(null==t||i.length<1){var s="getValue";if(e.getV3MethodMap){var r=e.getV3MethodMap();s=r[s]?r[s]:s}n=e[s]()}else{var a=t.getCurrentRecord();if(a)n=a[i[0]]}return n},getSingleColumnWidgetDefaultValue:function(e){var t=e.DefaultValue;if(t)return t;if(null==t||null==t)return"";var i={};return i[e.ColumnName]=t,i}}),isc.ClassFactory.defineClass("DataBindingUtil"),isc.DataBindingUtil.addClassMethods({_getVM:function(e){var t=e.TableName,i=isc.JGV3ValuesManager.genId(t.ID,e.scopeId,e.code);return isc.JGV3ValuesManager.getById(i,t)},_filterData:function(e,t){for(var i={},n=0,s=e.length;n<s;n++){var r=e[n];i[r]=t[r]}return i.id=t.id,i},setWidgetValue:function(e,t){var i=isc.DataBindingUtil._getVM(e);if(!e.getBindFields)throw Error("控件未提供getBindFields接口，无法绑定更新回调！控件类型："+e.getClassName());var n=e.getBindFields();i.setFieldCodes&&i.setFieldCodes([].concat(n));var s=i.getValues(),r={};for(var a in s&&Object.assign(r,s),r)r.hasOwnProperty(a)&&"id"!=a&&-1==n.indexOf(a)&&delete r[a];var d=isc.DataBindingUtil._filterData(n,t);for(var a in d)d.hasOwnProperty(a)&&(r[a]=d[a]);i.editRecord(r)},clearWidgetValue:function(e){isc.DataBindingUtil._getVM(e).clearValues()},bindEvent:function(e,t,i){e.on(t,i)}}),isc.ClassFactory.defineClass("DatasourceUtil"),isc.DatasourceUtil.addClassMethods({_checkDatasource:function(e){return null!=e&&null!=e&&"string"!=typeof e},addDatasourceCurrentEventHandler:function(e,t){var i=isc.WidgetDatasource.getDatasource(e);this._checkDatasource(i)&&e&&t&&i.on(i.Events.CURRENT,null,(function(){t.apply(i,arguments)}))},addDatasourceSelectEventHandler:function(e,t){var i=isc.WidgetDatasource.getDatasource(e);this._checkDatasource(i)&&e&&handler&&i.on(i.Events.SELECT,null,(function(){handler.apply(i,arguments)}))},addDatasourceUpdateEventHandler:function(e,t){var i=isc.WidgetDatasource.getDatasource(e);this._checkDatasource(i)&&e&&t&&i.on(i.Events.UPDATE,null,(function(){t.apply(i,arguments)}))},addDatasourceFieldUpdateEventHandler:function(e,t,i){var n=isc.WidgetDatasource.getDatasource(e);this._checkDatasource(n)&&(null!=(t=isc.WidgetDatasource.getFields(e,t))&&null!=t&&e&&i&&n.on(n.Events.UPDATE,null,(function(e){for(var n=e.resultSet,s=!1,r=0,a=n.length;r<a;r++){var d=n[r];for(r=0;r<t.length;r++){var l=t[r];if(d.hasOwnProperty(l)){s=!0;break}}}s&&i(e)})))},addDatasourceDeleteEventHandler:function(e,t){var i=isc.WidgetDatasource.getDatasource(e);this._checkDatasource(i)&&e&&t&&i.on(i.Events.DELETE,null,(function(){t.apply(i,arguments)}))},addDatasourceLoadEventHandler:function(e,t){var i=isc.WidgetDatasource.getDatasource(e);this._checkDatasource(i)&&e&&t&&i.on(i.Events.LOAD,null,(function(){t.apply(i,arguments)}))},addDatasourceInsertEventHandler:function(e,t){var i=isc.WidgetDatasource.getDatasource(e);this._checkDatasource(i)&&e&&t&&i.on(i.Events.INSERT,null,(function(){t.apply(i,arguments)}))}}),isc.ClassFactory.defineClass("Environment"),isc.Environment.addClassMethods({parseCssStr:function(e){if(e){var t=document.getElementById("_$styleWrapDiv");t||((t=document.createElement("div")).setAttribute("id","_$styleWrapDiv"),t.setAttribute("style","display:none;"),document.body.appendChild(t));var i=t.children[0];i&&(e=i.innerHTML+e);var n="_<style id='cslk'>"+e+"</style>";t.innerHTML=n}}}),isc.ClassFactory.defineClass("I18N"),isc.I18N.addClassMethods({get:function(e,t){return"object"==typeof e&&e.code?vdk&&vdk.i18n?vdk.i18n.get(e):e.defaultVal:e},isUseLanguage:function(e){return!(!vdk||!vdk.i18n)&&vdk.i18n.isUseLanguage(e)}}),isc.ClassFactory.defineClass("FileUtil"),isc.FileUtil.addClassMethods({getImageById:function(e){return null==e||""==e?"":'module-operation!executeOperation?operation=FileDown&token={"data":{"dataId":"'+e+'"}}'},getImageByName:function(e){return null==e||""==e?"":"itop/resources/"+e}}),isc.ClassFactory.defineClass("MenuUtil"),isc.MenuUtil.addClassMethods({systemSort:function(e){return e.sort((function(e,t){return e.orderNo-t.orderNo}))},_genMenuTable:function(e){var t={};return e.id&&(t.id=e.id),e.isItem&&(t.isItem=e.isItem),e.menuItemType&&("win"===e.menuItemType?t.type=0:"rule"===e.menuItemType?t.type=1:t.type=e.menuItemType),e.openType&&(t.openType=e.openType),e.openCompCode&&(t.compCode=e.openCompCode),e.openWinCode&&(t.winCode=e.openWinCode),e.requestParams&&(t.params=e.requestParams),e.ruleSetComponentCode&&(t.ruleCompCode=e.ruleSetComponentCode),e.ruleSetWindowCode&&(t.ruleWinCode=e.ruleSetWindowCode),e.ruleSetCode&&(t.ruleCode=e.ruleSetCode),e.ruleSetInputParam&&(t.ruleParams=e.ruleSetInputParam),(e.title||e.menuItemName)&&(t.title=e.title?e.title:e.menuItemName),e.visible&&(t.visible=e.visible),e.enabled&&(t.enabled=e.enabled),e.isMore&&(t.isMore=e.isMore),e.showBorder&&(t.showBorder=e.showBorder),e.displayStyle&&(t.displayStyle=e.displayStyle),e.appearance&&(t.appearance=e.appearance),e.theme&&(t.theme=e.theme),t},_findParent:function(e,t){var i=null,n=t.parentId;if(e)for(var s=0,r=e.length;s<r;s++){var a=e[s];if(a.id==n){i=a;break}a.submenu&&isc.MenuUtil._findParent(a.submenu,t)}return i},_genMenuItem:function(e,t){var i={};if(i.id=e.id,i.title=e.menuItemName,i.name=i.title,i.isselected=e.isSelected,i.visible=e.visible,null==i.visible&&(i.visible=!0),i.enabled=e.enabled,null==i.enabled&&(i.enabled=!0),i.isMore=e.isMore,i.showBorder=e.showBorder,i.displayStyle=e.displayStyle,i.appearance=e.appearance,i.openType=e.openType,i.openWinTitle=e.openWinTitle,i.isItem=e.isItem,i.theme=e.theme,e.icourl){var n=isc.JSON.decode(e.icourl);if(n)for(var s=0,r=n.length;s<r;s++){var a=n[s];a&&a.type==t&&(i.source=a.source),!a||"db"!=a.source||a.type!=t&&null!=t?!a||"url"!=a.source||a.type!=t&&null!=t?!a||"res"!=a.source||a.type!=t&&null!=t?!a||"icon"!=a.source||a.type!=t&&null!=t||(i.icon=a.img,i.iconSource=a.source):(i.icon="/itop/resources/"+a.img,i.iconSource=a.source):(i.icon=a.img,i.iconSource=a.source):(i.icon="module-operation!executeOperation?operation=FileDown&token=%7B%22data%22%3A%7B%22dataId%22%3A%22"+a.img+"%22%2C%22ImageObj%22%3A%22"+a.img+"%22%7D%7D",i.iconSource=a.source)}}if(i.code=e.menuItemCode,i.parentId=e.pid,e.submenu){i.submenu=[];s=0;for(var d=e.submenu.length;s<d;s++)e.submenu[s].visible&&i.submenu.push(isc.MenuUtil._genMenuItem(e.submenu[s]))}return i},toMenuData:function(e,t){if(0!=e.length){var i=e[0];if(!(i.hasOwnProperty("id")&&i.hasOwnProperty("pid")&&i.hasOwnProperty("menuItemName")))throw new Error("菜单数据格式不正确");for(var n=[],s={},r=0,a=(e=isc.MenuUtil.systemSort(e)).length;r<a;r++)n.push(isc.MenuUtil._genMenuItem(e[r],t)),s[e[r].id]=isc.MenuUtil._genMenuTable(e[r]);var d=[];for(r=0,a=n.length;r<a;r++){var l=n[r],o=isc.MenuUtil._findParent(n,l);null==o?d.push(l):(o.submenu||(o.submenu=[]),o.submenu.push(l))}return d.length>0&&d[0].submenu?[d[0].submenu,s]:d.length>0?[d,s]:void 0}},getMenuDataByRuleSet:function(e,t){for(var i=e.Param&&e.Param.invokeParams,n={},s=0,r=i.length;s<r;s++){var a=i[s];if("expression"==a.paramType){var d="";if(""!=a.paramValue&&null!=a.paramValue){if(!t)throw Error("未传入表达式处理器！");d=t(a.paramValue)}n[a.paramCode]=d}else a.paramType}},returnEventId:function(e){var t=e;return e&&(e.id?t=e.id:e.target&&e.target.id&&(t=e.target.id)),t},menuEvent:function(e,t,i,n,s,r){n&&"function"==typeof n||(n=function(){});var a=isc.MenuUtil.returnEventId(t);if(e.menuTable&&t){var d=e.menuTable[a];if(t.openWinTitle&&(d.openWinTitle=t.openWinTitle),d&&d.isItem){if(!r)throw Error("未传入菜单动作处理器！");var l=r(d.type);if(null==l)throw n(),new Error("没有合适的菜单类型处理器. 菜单类型："+d.type);l.doAction({properties:e,data:d,error:s,callback:n})}else n()}else i.call(this,a)}})}));
